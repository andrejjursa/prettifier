tinymce.PluginManager.add("prettifier",function(e,t){var n=(tinymce.util.Tools.resolve("tinymce.PluginManager"),tinymce.util.Tools.resolve("tinymce.dom.DOMUtils")),i=function(e){var t=e,n=function(){return t}
return{get:n,set:function(e){t=e},clone:function(){return i(n())}}},r=[{text:"Bash",value:"bsh"},{text:"C",value:"c"},{text:"C++ (cc)",value:"cc"},{text:"C++ (cpp)",value:"cpp"},{text:"C#",value:"cs"},{text:"C shell",value:"csh"},{text:"CYCAS",value:"cyc"},{text:"CodeView",value:"cv"},{text:"HTML (htm)",value:"htm"},{text:"HTML (html)",value:"html"},{text:"Java",value:"java"},{text:"JavaScript",value:"js"},{text:"Matlab",value:"m"},{text:"MXML",value:"mxml"},{text:"Perl script",value:"perl"},{text:"Perl module",value:"pm"},{text:"Prolog",value:"pl"},{text:"Ruby",value:"rb"},{text:"Shell",value:"sh"},{text:"XHTML",value:"xhtml"},{text:"XML",value:"xml"},{text:"XSL",value:"xsl"}],a=function(e){if("undefined"==typeof prettyPrintOne)return!1
var t=e.innerHTML,n=e.className.match(/lang-(\w+)/),i=""
n&&(i=n[1])
var r=prettyPrintOne(t,i)
e.innerHTML=r},l=function(e){return e&&"PRE"===e.nodeName&&-1!==e.className.indexOf("prettyprint")},o=function(e){var t=e.selection.getNode()
return l(t)?t:null},c=function(e){var t=o(e)
return t?t.textContent:""},u=function(e){var t=o(e)
if(t){var n=t.className.match(/lang-(\w+)/)
return n?n[1]:""}return""},s=function(e){var t=o(e)
if(t){return t.className.match(/linenums/)?1:0}return 0},d=function(e,t,i,r){e.undoManager.transact(function(){var l=o(e)
t=n.DOM.encode(t)
var c=""
r>0&&(c="linenums"),l?(e.dom.setAttrib(l,"class","prettyprint lang-"+i+" "+c),l.innerHTML=t,a(l),e.selection.select(l)):(e.insertContent('<pre id="__new_code" class="prettyprint lang-'+i+" "+c+'">'+t+"</pre>"),e.selection.select(e.$("#__new_code").removeAttr("id")[0]))})},f=function(e){return function(t,n){return e(n)}},m=function(e){return e.settings.prettifier_content_css},p=function(e){var t=e.settings.prettifier_languages,n=r
return"object"==typeof t&&(n=t),n},v=function(e){return e.settings.prettifier_dialog_width?e.settings.prettifier_dialog_width:600},g=function(e){return e.settings.prettifier_dialog_height?e.settings.prettifier_dialog_height:500},x=function(e,t,n,i){var r,a=m(e)
if((!e.inline||!n.get())&&(e.inline||!i.get())&&(e.inline?n.set(!0):i.set(!0),!1!==a&&(r=e.dom.create("link",{rel:"stylesheet",href:a||t+"/css/prettify.min.css"}),e.getDoc().getElementsByTagName("head")[0].appendChild(r)),void 0===window.prettifier_plugin_global_css)){window.prettifier_plugin_global_css=!0
var l=document.getElementsByTagName("HEAD"),o=document.createElement("LINK")
o.setAttribute("type","text/css"),o.setAttribute("rel","stylesheet"),o.setAttribute("href",t+"/css/plugin.min.css"),l[0].appendChild(o)}},h=function(e){var t=c(e),n=u(e),i=s(e),r=p(e),a=v(e),l=g(e)
e.windowManager.open({title:"Insert/Edit code",minWidth:a,minHeight:l,layout:"flex",direction:"column",align:"stretch",body:[{type:"listbox",name:"language",label:"Language",values:r,value:n},{type:"textbox",name:"code",ariaLabel:"Code",multiline:!0,spellcheck:!1,flex:1,style:"direction: ltr; text-align: left;",classes:"monospace",autofocus:!0,value:t},{type:"listbox",name:"linenums",label:"Line numbers",values:[{text:"Off",value:0},{text:"On",value:1}],value:i}],onsubmit:function(t){d(e,t.data.code,t.data.language,t.data.linenums)}})}
e.addButton("prettifier",{cmd:"prettifier",title:"Insert/Edit code",icon:"prettifier"}),e.addMenuItem("prettifier",{cmd:"prettifier",text:"Insert/Edit code",icon:"prettifier",context:"tools"}),e.on("PreProcess",function(t){e.$("pre[contenteditable=false]",t.node).filter(f(l)).each(function(t,i){var r=e.$(i),a=i.textContent
r.attr("class",$.trim(r.attr("class"))),r.removeAttr("contentEditable"),r.empty().append(n.DOM.encode(a))})}),e.on("SetContent",function(){var t=e.$("pre").filter(f(l)).filter(function(e,t){return"false"!==t.contentEditable})
t.length&&e.undoManager.transact(function(){t.each(function(t,n){e.$(n).find("br").each(function(t,n){n.parentNode.replaceChild(e.getDoc().createTextNode("\n"),n)}),n.contentEditable=!1,n.innerHTML=e.dom.encode(n.textContent),a(n),n.className=e.$.trim(n.className)})})})
var y=i(!1),b=i(!1)
return e.addCommand("prettifier",function(){var t=e.selection.getNode();(e.selection.isCollapsed()||l(t))&&h(e)}),e.on("init",function(){x(e,t,y,b)}),e.on("dblclick",function(t){l(t.target)&&h(e)}),{}})
