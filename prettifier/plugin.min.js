tinymce.PluginManager.add("prettifier",function(e,t){var n=(tinymce.util.Tools.resolve("tinymce.PluginManager"),tinymce.util.Tools.resolve("tinymce.dom.DOMUtils")),i=function(e){var t=e,n=function(){return t}
return{get:n,set:function(e){t=e},clone:function(){return i(n())}}},r=[{text:"Bash",value:"bsh"},{text:"C",value:"c"},{text:"C++ (cc)",value:"cc"},{text:"C++ (cpp)",value:"cpp"},{text:"C#",value:"cs"},{text:"C shell",value:"csh"},{text:"CYCAS",value:"cyc"},{text:"CodeView",value:"cv"},{text:"HTML (htm)",value:"htm"},{text:"HTML (html)",value:"html"},{text:"Java",value:"java"},{text:"JavaScript",value:"js"},{text:"Matlab",value:"m"},{text:"MXML",value:"mxml"},{text:"Perl script",value:"perl"},{text:"Perl module",value:"pm"},{text:"Prolog",value:"pl"},{text:"Ruby",value:"rb"},{text:"Shell",value:"sh"},{text:"XHTML",value:"xhtml"},{text:"XML",value:"xml"},{text:"XSL",value:"xsl"}],o=function(e){if("undefined"==typeof prettyPrintOne)return!1
var t=e.innerHTML,n=e.className.match(/lang-(\w+)/),i=""
n&&(i=n[1])
var r=prettyPrintOne(t,i)
e.innerHTML=r},a=function(e){return e&&"PRE"===e.nodeName&&-1!==e.className.indexOf("prettyprint")},l=function(e){var t=e.selection.getNode()
return a(t)?t:null},c=function(e){var t=l(e)
return t?t.textContent:""},s=function(e){var t=l(e)
if(t){var n=t.className.match(/lang-(\w+)/)
return n?n[1]:""}return""},u=function(e,t,i){e.undoManager.transact(function(){var r=l(e)
console.log(t),t=n.DOM.encode(t),console.log(t),r?(e.dom.setAttrib(r,"class","prettyprint lang-"+i),r.innerHTML=t,o(r),e.selection.select(r)):(e.insertContent('<pre id="__new_code" class="prettyprint lang-'+i+'">'+t+"</pre>"),e.selection.select(e.$("#__new_code").removeAttr("id")[0]))})},d=function(e){return function(t,n){return e(n)}},f=function(e){return e.settings.prettifier_content_css},g=function(e){var t=e.settings.prettifier_languages,n=r
return"object"==typeof t&&(n=t),n},p=function(e){return e.settings.prettifier_dialog_width?e.settings.prettifier_dialog_width:600},v=function(e){return e.settings.prettifier_dialog_height?e.settings.prettifier_dialog_height:500},m=function(e,t,n,i){var r,o=f(e)
e.inline&&n.get()||!e.inline&&i.get()||(e.inline?n.set(!0):i.set(!0),!1!==o&&(r=e.dom.create("link",{rel:"stylesheet",href:o||t+"/css/prettify.css"}),e.getDoc().getElementsByTagName("head")[0].appendChild(r)))},x=function(e){var t=c(e),n=s(e),i=g(e),r=p(e),o=v(e)
e.windowManager.open({title:"Insert/Edit code",minWidth:r,minHeight:o,layout:"flex",direction:"column",align:"stretch",body:[{type:"listbox",name:"language",label:"Language",values:i,value:n},{type:"textbox",name:"code",ariaLabel:"Code",multiline:!0,spellcheck:!1,flex:1,style:"direction: ltr; text-align: left;",classes:"monospace",autofocus:!0,value:t}],onsubmit:function(t){u(e,t.data.code,t.data.language)}})}
e.addButton("prettifier",{cmd:"prettifier",title:"Insert/Edit code",text:"Insert/Edit code",icon:"prettifier"}),e.addMenuItem("prettifier",{cmd:"prettifier",text:"Insert/Edit code",icon:"prettifier",context:"tools"}),e.on("PreProcess",function(t){e.$("pre[contenteditable=false]",t.node).filter(d(a)).each(function(t,i){console.log(i)
var r=e.$(i),o=i.textContent
console.log(o),r.attr("class",$.trim(r.attr("class"))),r.removeAttr("contentEditable"),r.empty().append(n.DOM.encode(o))})}),e.on("SetContent",function(){var t=e.$("pre").filter(d(a)).filter(function(e,t){return"false"!==t.contentEditable})
t.length&&e.undoManager.transact(function(){t.each(function(t,n){e.$(n).find("br").each(function(t,n){n.parentNode.replaceChild(e.getDoc().createTextNode("\n"),n)}),n.contentEditable=!1,console.log(n),console.log(n.textContent),n.innerHTML=e.dom.encode(n.textContent),console.log(n),o(n),n.className=e.$.trim(n.className)})})})
var h=i(!1),y=i(!1)
return e.addCommand("prettifier",function(){var t=e.selection.getNode();(e.selection.isCollapsed()||a(t))&&x(e)}),e.on("init",function(){m(e,t,h,y)}),e.on("dblclick",function(t){a(t.target)&&x(e)}),{}})
