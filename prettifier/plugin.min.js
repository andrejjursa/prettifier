tinymce.PluginManager.add("prettifier",function(e,t){var n=(tinymce.util.Tools.resolve("tinymce.PluginManager"),tinymce.util.Tools.resolve("tinymce.dom.DOMUtils")),o=function(e){var t=e,n=function(){return t}
return{get:n,set:function(e){t=e},clone:function(){return o(n())}}},i=function(e){if("undefined"==typeof prettyPrintOne)return!1
var t=e.innerHTML,n=e.className.match(/lang-(\w+)/),o=""
n&&(o=n[1])
var i=prettyPrintOne(t,o)
e.innerHTML=i},r=function(e){return e&&"PRE"===e.nodeName&&-1!==e.className.indexOf("prettyprint")},a=function(e){var t=e.selection.getNode()
return r(t)?t:null},c=function(e){var t=a(e)
return t?t.textContent:""},l=function(e){var t=a(e)
if(t){var n=t.className.match(/lang-(\w+)/)
return n?n[1]:""}return""},s=function(e,t,o){e.undoManager.transact(function(){var r=a(e)
console.log(t),t=n.DOM.encode(t),console.log(t),r?(e.dom.setAttrib(r,"class","prettyprint lang-"+o),r.innerHTML=t,i(r),e.selection.select(r)):(e.insertContent('<pre id="__new_code" class="prettyprint lang-'+o+'">'+t+"</pre>"),e.selection.select(e.$("#__new_code").removeAttr("id")[0]))})},d=function(e){return function(t,n){return e(n)}},u=function(e){return e.settings.codesample_content_css},f=function(e,t,n,o){var i,r=u(e)
if((!e.inline||!n.get())&&(e.inline||!o.get())){e.inline?n.set(!0):o.set(!0),!1!==r&&(i=e.dom.create("link",{rel:"stylesheet",href:r||t+"/css/prettify.css"}),e.getDoc().getElementsByTagName("head")[0].appendChild(i))
var a=e.dom.create("link",{rel:"stylesheet",href:t+"/css/plugin.css"})
e.getDoc().getElementsByTagName("head")[0].appendChild(a)}},g=function(e){var t=c(e),n=l(e)
e.windowManager.open({title:"Insert/Edit code",minWidth:"600",minHeight:"500",layout:"flex",direction:"column",align:"stretch",body:[{type:"listbox",name:"language",label:"Language",values:[{text:"HTML",value:"html"},{text:"PHP",value:"php"}],value:n},{type:"textbox",name:"code",ariaLabel:"Code",multiline:!0,spellcheck:!1,flex:1,style:"direction: ltr; text-align: left;",classes:"monospace",autofocus:!0,value:t}],onsubmit:function(t){s(e,t.data.code,t.data.language)}})}
e.addButton("prettifier",{cmd:"prettifier",title:"Insert/Edit code",text:"Insert/Edit code",icon:"prettifier"}),e.addMenuItem("prettifier",{cmd:"prettifier",text:"Insert/Edit code",icon:"prettifier",context:"tools"}),e.on("PreProcess",function(t){e.$("pre[contenteditable=false]",t.node).filter(d(r)).each(function(t,o){console.log(o)
var i=e.$(o),r=o.textContent
console.log(r),i.attr("class",$.trim(i.attr("class"))),i.removeAttr("contentEditable"),i.empty().append(n.DOM.encode(r))})}),e.on("SetContent",function(){var t=e.$("pre").filter(d(r)).filter(function(e,t){return"false"!==t.contentEditable})
t.length&&e.undoManager.transact(function(){t.each(function(t,n){e.$(n).find("br").each(function(t,n){n.parentNode.replaceChild(e.getDoc().createTextNode("\n"),n)}),n.contentEditable=!1,console.log(n),console.log(n.textContent),n.innerHTML=e.dom.encode(n.textContent),console.log(n),i(n),n.className=e.$.trim(n.className)})})})
var m=o(!1),p=o(!1)
return e.addCommand("prettifier",function(){var t=e.selection.getNode();(e.selection.isCollapsed()||r(t))&&g(e)}),e.on("init",function(){f(e,t,m,p)}),e.on("dblclick",function(t){r(t.target)&&g(e)}),{}})
