tinymce.PluginManager.add("prettifier",function(e,t){var n=(tinymce.util.Tools.resolve("tinymce.PluginManager"),tinymce.util.Tools.resolve("tinymce.dom.DOMUtils")),l=function(e){var t=e,n=function(){return t}
return{get:n,set:function(e){t=e},clone:function(){return l(n())}}},a=[{text:"Bash",value:"bsh"},{text:"C",value:"c"},{text:"C++ (cc)",value:"cc"},{text:"C++ (cpp)",value:"cpp"},{text:"C#",value:"cs"},{text:"C shell",value:"csh"},{text:"CYCAS",value:"cyc"},{text:"CodeView",value:"cv"},{text:"HTML (htm)",value:"htm"},{text:"HTML (html)",value:"html"},{text:"Java",value:"java"},{text:"JavaScript",value:"js"},{text:"Matlab",value:"m"},{text:"MXML",value:"mxml"},{text:"Perl script",value:"perl"},{text:"Perl module",value:"pm"},{text:"Prolog",value:"pl"},{text:"Ruby",value:"rb"},{text:"Shell",value:"sh"},{text:"XHTML",value:"xhtml"},{text:"XML",value:"xml"},{text:"XSL",value:"xsl"}],o=function(e){if("undefined"==typeof prettyPrintOne)return!1
var t=e.innerHTML,n=e.className.match(/lang-(\w+)/),l=""
n&&(l=n[1])
var a=prettyPrintOne(t,l)
e.innerHTML=a},i=function(e){return e&&"PRE"===e.nodeName&&-1!==e.className.indexOf("prettyprint")},r=function(e){var t=e.selection.getNode()
return i(t)?t:null},c=function(e){var t=r(e)
return t?t.textContent:""},s=function(e){var t=r(e)
if(t){var n=t.className.match(/lang-(\w+)/)
return n?n[1]:""}return""},u=function(e,t,l){e.undoManager.transact(function(){var a=r(e)
console.log(t),t=n.DOM.encode(t),console.log(t),a?(e.dom.setAttrib(a,"class","prettyprint lang-"+l),a.innerHTML=t,o(a),e.selection.select(a)):(e.insertContent('<pre id="__new_code" class="prettyprint lang-'+l+'">'+t+"</pre>"),e.selection.select(e.$("#__new_code").removeAttr("id")[0]))})},d=function(e){return function(t,n){return e(n)}},f=function(e){return e.settings.codesample_content_css},m=function(e,t,n,l){var a,o=f(e)
if((!e.inline||!n.get())&&(e.inline||!l.get())){e.inline?n.set(!0):l.set(!0),!1!==o&&(a=e.dom.create("link",{rel:"stylesheet",href:o||t+"/css/prettify.css"}),e.getDoc().getElementsByTagName("head")[0].appendChild(a))
var i=e.dom.create("link",{rel:"stylesheet",href:t+"/css/plugin.css"})
e.getDoc().getElementsByTagName("head")[0].appendChild(i)}},v=function(e){var t=c(e),n=s(e)
e.windowManager.open({title:"Insert/Edit code",minWidth:"600",minHeight:"500",layout:"flex",direction:"column",align:"stretch",body:[{type:"listbox",name:"language",label:"Language",values:a,value:n},{type:"textbox",name:"code",ariaLabel:"Code",multiline:!0,spellcheck:!1,flex:1,style:"direction: ltr; text-align: left;",classes:"monospace",autofocus:!0,value:t}],onsubmit:function(t){u(e,t.data.code,t.data.language)}})}
e.addButton("prettifier",{cmd:"prettifier",title:"Insert/Edit code",text:"Insert/Edit code",icon:"prettifier"}),e.addMenuItem("prettifier",{cmd:"prettifier",text:"Insert/Edit code",icon:"prettifier",context:"tools"}),e.on("PreProcess",function(t){e.$("pre[contenteditable=false]",t.node).filter(d(i)).each(function(t,l){console.log(l)
var a=e.$(l),o=l.textContent
console.log(o),a.attr("class",$.trim(a.attr("class"))),a.removeAttr("contentEditable"),a.empty().append(n.DOM.encode(o))})}),e.on("SetContent",function(){var t=e.$("pre").filter(d(i)).filter(function(e,t){return"false"!==t.contentEditable})
t.length&&e.undoManager.transact(function(){t.each(function(t,n){e.$(n).find("br").each(function(t,n){n.parentNode.replaceChild(e.getDoc().createTextNode("\n"),n)}),n.contentEditable=!1,console.log(n),console.log(n.textContent),n.innerHTML=e.dom.encode(n.textContent),console.log(n),o(n),n.className=e.$.trim(n.className)})})})
var p=l(!1),g=l(!1)
return e.addCommand("prettifier",function(){var t=e.selection.getNode();(e.selection.isCollapsed()||i(t))&&v(e)}),e.on("init",function(){m(e,t,p,g)}),e.on("dblclick",function(t){i(t.target)&&v(e)}),{}})
